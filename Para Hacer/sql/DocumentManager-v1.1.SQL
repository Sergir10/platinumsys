/*
Created: 1/6/2012
Modified: 1/16/2012
Model: DocumentManager
Database: Oracle 10g
*/

-- Create sequences section -------------------------------------------------


CREATE SEQUENCE "SEQ_URL_APLICACION"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 999999999999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_DOCUMENTO"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 999999999999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_HISTORICO"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_TIPO_DOCUMENTO"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 99999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_PROPIEDAD"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 9999999999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_FORMATO"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 9999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_FUNCIONALIDAD"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 99999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_TIPO_OPERACION"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 99999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_COLA"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 99999
 MINVALUE 1
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_HISTORICO_COLA"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "SEQ_ID_ROL"
 INCREMENT BY 1
 START WITH 1
 MAXVALUE 99999
 MINVALUE 1
 CACHE 20
/

-- Create tables section -------------------------------------------------

-- Table TIPO_DOCUMENTO

CREATE TABLE "TIPO_DOCUMENTO"(
  "ID_TIPO_DOCUMENTO" Number(5,0) NOT NULL,
  "DESCRIPCION" Varchar2(30 ) NOT NULL
)
/

-- Add keys for table TIPO_DOCUMENTO

ALTER TABLE "TIPO_DOCUMENTO" ADD CONSTRAINT "Key1" PRIMARY KEY ("ID_TIPO_DOCUMENTO")
/

-- Table PROPIEDAD

CREATE TABLE "PROPIEDAD"(
  "ID_PROPIEDAD" Number(10,0) NOT NULL,
  "DESCRIPCION" Varchar2(30 ) NOT NULL,
  "TIPO_PROPIEDAD" Char(1 ) NOT NULL
        CONSTRAINT "CHK_TIPO_PROPIEDAD" CHECK (TIPO_PROPIEDAD IN ('N', 'D', 'S'))
)
/

-- Add keys for table PROPIEDAD

ALTER TABLE "PROPIEDAD" ADD CONSTRAINT "Key2" PRIMARY KEY ("ID_PROPIEDAD")
/

-- Table PROPIEDAD_TIPO_DOCUMENTO

CREATE TABLE "PROPIEDAD_TIPO_DOCUMENTO"(
  "ID_TIPO_DOCUMENTO" Number(5,0) NOT NULL,
  "ID_PROPIEDAD" Number(10,0) NOT NULL,
  "MANDATORIO" Char(1 CHAR) DEFAULT 'S' NOT NULL
        CONSTRAINT "CHK_TIPO_PROPIEDAD_MANDATORIO" CHECK (MANDATORIO IN ('S', 'N')),
  "ID_FORMATO" Number(4,0),
  "SECUENCIA_CARGA" Number(5,0)
)
/

-- Add keys for table PROPIEDAD_TIPO_DOCUMENTO

ALTER TABLE "PROPIEDAD_TIPO_DOCUMENTO" ADD CONSTRAINT "Key3" PRIMARY KEY ("ID_TIPO_DOCUMENTO","ID_PROPIEDAD")
/

-- Table DOCUMENTO

CREATE TABLE "DOCUMENTO"(
  "ID_DOCUMENTO" Number(12,0) NOT NULL,
  "ID_TIPO_DOCUMENTO" Number(5,0),
  "UBICACION" Varchar2(255 CHAR) NOT NULL,
  "FECHA_INGRESO" Date NOT NULL,
  "TAMANHO" Number(8,0) NOT NULL,
  "NOMBRE_SCANEO" Varchar2(30 ) NOT NULL,
  "SHA1" Varchar2(40 )
)
/

-- Add keys for table DOCUMENTO

ALTER TABLE "DOCUMENTO" ADD CONSTRAINT "Key4" PRIMARY KEY ("ID_DOCUMENTO")
/

-- Table PROPIEDAD_DOCUMENTO

CREATE TABLE "PROPIEDAD_DOCUMENTO"(
  "ID_DOCUMENTO" Number(12,0) NOT NULL,
  "ID_PROPIEDAD" Number(10,0) NOT NULL,
  "VALOR" Varchar2(50 ) NOT NULL
)
/

-- Add keys for table PROPIEDAD_DOCUMENTO

ALTER TABLE "PROPIEDAD_DOCUMENTO" ADD CONSTRAINT "Key5" PRIMARY KEY ("ID_DOCUMENTO","ID_PROPIEDAD")
/

-- Table ROL

CREATE TABLE "ROL"(
  "ID_ROL" Number(4,0) NOT NULL,
  "DESCRIPCION" Varchar2(30 ) NOT NULL
)
/

-- Add keys for table ROL

ALTER TABLE "ROL" ADD CONSTRAINT "Key6" PRIMARY KEY ("ID_ROL")
/

-- Table USUARIO

CREATE TABLE "USUARIO"(
  "ID_USUARIO" Varchar2(20) NOT NULL,
  "NOMBRE" Varchar2(30 ) NOT NULL,
  "APELLIDO" Varchar2(30 ) NOT NULL
)
/

-- Add keys for table USUARIO

ALTER TABLE "USUARIO" ADD CONSTRAINT "Key7" PRIMARY KEY ("ID_USUARIO")
/

-- Table ROL_USUARIO

CREATE TABLE "ROL_USUARIO"(
  "ID_USUARIO" Varchar2(20) NOT NULL,
  "ID_ROL" Number(4,0) NOT NULL
)
/

-- Add keys for table ROL_USUARIO

ALTER TABLE "ROL_USUARIO" ADD CONSTRAINT "Key8" PRIMARY KEY ("ID_USUARIO","ID_ROL")
/

-- Table PERMISO

CREATE TABLE "PERMISO"(
  "ID_PERMISO" Varchar2(30 ) NOT NULL,
  "DESCRIPCION" Varchar2(30 ) NOT NULL
)
/

-- Add keys for table PERMISO

ALTER TABLE "PERMISO" ADD CONSTRAINT "Key9" PRIMARY KEY ("ID_PERMISO")
/

-- Table and Columns comments section
  
COMMENT ON TABLE "PERMISO" IS '1: Acceder
2: Agregar
3: Editar
4: Borrar
5: Guardar
6: Consultar'
/

-- Table HISTORICO

CREATE TABLE "HISTORICO"(
  "ID_HISTORICO" Number NOT NULL,
  "ID_DOCUMENTO" Number(12,0),
  "ID_USUARIO" Varchar2(20),
  "ID_TIPO_OPERACION" Number(5,0),
  "FECHA" Date NOT NULL,
  "ID_PROPIEDAD" Number(10,0),
  "VALOR_ANTERIOR" Varchar2(50 ),
  "VALOR_ACTUAL" Varchar2(50 )
)
/

-- Add keys for table HISTORICO

ALTER TABLE "HISTORICO" ADD CONSTRAINT "Key11" PRIMARY KEY ("ID_HISTORICO")
/

-- Table TIPO_OPERACION

CREATE TABLE "TIPO_OPERACION"(
  "ID_TIPO_OPERACION" Number(5,0) NOT NULL,
  "DESCRIPCION" Varchar2(50 ) NOT NULL
)
/

-- Add keys for table TIPO_OPERACION

ALTER TABLE "TIPO_OPERACION" ADD CONSTRAINT "Key12" PRIMARY KEY ("ID_TIPO_OPERACION")
/

-- Table ROL_PERMISO

CREATE TABLE "ROL_PERMISO"(
  "ID_ROL" Number(4,0) NOT NULL,
  "ID_PERMISO" Varchar2(30 ) NOT NULL,
  "ID_URL" Number(5,0) NOT NULL
)
/

-- Add keys for table ROL_PERMISO

ALTER TABLE "ROL_PERMISO" ADD CONSTRAINT "Key14" PRIMARY KEY ("ID_ROL","ID_PERMISO","ID_URL")
/

-- Table FORMATO

CREATE TABLE "FORMATO"(
  "ID_FORMATO" Number(4,0) NOT NULL,
  "DESCRIPCION" Char(20 ),
  "PLANTILLA" Char(20 )
)
/

-- Add keys for table FORMATO

ALTER TABLE "FORMATO" ADD CONSTRAINT "Key15" PRIMARY KEY ("ID_FORMATO")
/

-- Table COLA

CREATE TABLE "COLA"(
  "ID_COLA" Number(5,0) NOT NULL,
  "DIRECTORIO" Varchar2(255 ) NOT NULL,
  "DIR_BACKUP" Varchar2(255 ) NOT NULL
)
/

-- Add keys for table COLA

ALTER TABLE "COLA" ADD CONSTRAINT "Key16" PRIMARY KEY ("ID_COLA")
/

ALTER TABLE "COLA" ADD CONSTRAINT "DIRECTORIO" UNIQUE ("DIRECTORIO")
/

-- Table DOCUMENTO_COLA

CREATE TABLE "DOCUMENTO_COLA"(
  "NOMBRE_DOCUMENTO" Varchar2(100 ) NOT NULL,
  "ID_COLA" Number(5,0) NOT NULL,
  "ESTADO" Char(1 CHAR) NOT NULL
        CONSTRAINT "CHK_DOC_COLA_ESTADO" CHECK (ESTADO IN ('L', 'P', 'T'))
)
/

-- Add keys for table DOCUMENTO_COLA

ALTER TABLE "DOCUMENTO_COLA" ADD CONSTRAINT "Key17" PRIMARY KEY ("ID_COLA","NOMBRE_DOCUMENTO")
/

-- Table HISTORICO_COLA

CREATE TABLE "HISTORICO_COLA"(
  "ID_HISTORICO_COLA" Number NOT NULL,
  "ID_COLA" Number(5,0),
  "FECHA" Date NOT NULL,
  "NOMBRE_DOCUMENTO" Varchar2(100 ) NOT NULL,
  "ESTADO_FINAL" Char(20 )
)
/

-- Add keys for table HISTORICO_COLA

ALTER TABLE "HISTORICO_COLA" ADD CONSTRAINT "Key18" PRIMARY KEY ("ID_HISTORICO_COLA")
/

-- Table URL_APLICACION

CREATE TABLE "URL_APLICACION"(
  "ID_URL" Number(5,0) NOT NULL,
  "URL" Varchar2(255 ) NOT NULL
)
/

-- Add keys for table URL_APLICACION

ALTER TABLE "URL_APLICACION" ADD CONSTRAINT "Key19" PRIMARY KEY ("ID_URL")
/

-- Create relationships section ------------------------------------------------- 

ALTER TABLE "PROPIEDAD_TIPO_DOCUMENTO" ADD CONSTRAINT "fk_ptd_tipo_documento" FOREIGN KEY ("ID_TIPO_DOCUMENTO") REFERENCES "TIPO_DOCUMENTO" ("ID_TIPO_DOCUMENTO")
/

ALTER TABLE "PROPIEDAD_TIPO_DOCUMENTO" ADD CONSTRAINT "fk_ptd_propiedad" FOREIGN KEY ("ID_PROPIEDAD") REFERENCES "PROPIEDAD" ("ID_PROPIEDAD")
/

ALTER TABLE "PROPIEDAD_DOCUMENTO" ADD CONSTRAINT "fk_propiedad_doc_documento" FOREIGN KEY ("ID_DOCUMENTO") REFERENCES "DOCUMENTO" ("ID_DOCUMENTO")
/

ALTER TABLE "DOCUMENTO" ADD CONSTRAINT "fk_documento_tipo_documento" FOREIGN KEY ("ID_TIPO_DOCUMENTO") REFERENCES "TIPO_DOCUMENTO" ("ID_TIPO_DOCUMENTO")
/

ALTER TABLE "PROPIEDAD_DOCUMENTO" ADD CONSTRAINT "fk_propiedad_doc_propiedad" FOREIGN KEY ("ID_PROPIEDAD") REFERENCES "PROPIEDAD" ("ID_PROPIEDAD")
/

ALTER TABLE "ROL_USUARIO" ADD CONSTRAINT "fk_rol_usuario_usuario" FOREIGN KEY ("ID_USUARIO") REFERENCES "USUARIO" ("ID_USUARIO")
/

ALTER TABLE "ROL_USUARIO" ADD CONSTRAINT "fk_rol_usuario_rol" FOREIGN KEY ("ID_ROL") REFERENCES "ROL" ("ID_ROL")
/

ALTER TABLE "HISTORICO" ADD CONSTRAINT "fk_historico_usuario" FOREIGN KEY ("ID_USUARIO") REFERENCES "USUARIO" ("ID_USUARIO")
/

ALTER TABLE "HISTORICO" ADD CONSTRAINT "fk_historico_documento" FOREIGN KEY ("ID_DOCUMENTO") REFERENCES "DOCUMENTO" ("ID_DOCUMENTO")
/

ALTER TABLE "HISTORICO" ADD CONSTRAINT "fk_historico_tipo_operacion" FOREIGN KEY ("ID_TIPO_OPERACION") REFERENCES "TIPO_OPERACION" ("ID_TIPO_OPERACION")
/

ALTER TABLE "ROL_PERMISO" ADD CONSTRAINT "Relationship3" FOREIGN KEY ("ID_ROL") REFERENCES "ROL" ("ID_ROL")
/

ALTER TABLE "ROL_PERMISO" ADD CONSTRAINT "Relationship7" FOREIGN KEY ("ID_PERMISO") REFERENCES "PERMISO" ("ID_PERMISO")
/

ALTER TABLE "PROPIEDAD_TIPO_DOCUMENTO" ADD CONSTRAINT "Relationship9" FOREIGN KEY ("ID_FORMATO") REFERENCES "FORMATO" ("ID_FORMATO")
/

ALTER TABLE "HISTORICO" ADD CONSTRAINT "Relationship12" FOREIGN KEY ("ID_PROPIEDAD") REFERENCES "PROPIEDAD" ("ID_PROPIEDAD")
/

ALTER TABLE "DOCUMENTO_COLA" ADD CONSTRAINT "Relationship13" FOREIGN KEY ("ID_COLA") REFERENCES "COLA" ("ID_COLA")
/

ALTER TABLE "HISTORICO_COLA" ADD CONSTRAINT "Relationship14" FOREIGN KEY ("ID_COLA") REFERENCES "COLA" ("ID_COLA")
/

ALTER TABLE "ROL_PERMISO" ADD CONSTRAINT "Relationship15" FOREIGN KEY ("ID_URL") REFERENCES "URL_APLICACION" ("ID_URL")
/


-- Trigger for sequence SEQ_ID_TIPO_DOCUMENTO for column ID_TIPO_DOCUMENTO in table TIPO_DOCUMENTO ---------

CREATE OR REPLACE TRIGGER "ts_TIPO_DOCUMENTO_SEQ_ID_TIP_0" BEFORE INSERT
ON "TIPO_DOCUMENTO" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_TIPO_DOCUMENTO".nextval INTO :new."ID_TIPO_DOCUMENTO" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_TIPO_DOCUMENTO_SEQ_ID_TI_0" AFTER UPDATE OF "ID_TIPO_DOCUMENTO"
ON "TIPO_DOCUMENTO" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_TIPO_DOCUMENTO" in table "TIPO_DOCUMENTO" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_PROPIEDAD for column ID_PROPIEDAD in table PROPIEDAD ---------

CREATE OR REPLACE TRIGGER "ts_PROPIEDAD_SEQ_ID_PROPIEDAD" BEFORE INSERT
ON "PROPIEDAD" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_PROPIEDAD".nextval INTO :new."ID_PROPIEDAD" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_PROPIEDAD_SEQ_ID_PROPIEDAD" AFTER UPDATE OF "ID_PROPIEDAD"
ON "PROPIEDAD" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_PROPIEDAD" in table "PROPIEDAD" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_DOCUMENTO for column ID_DOCUMENTO in table DOCUMENTO ---------

CREATE OR REPLACE TRIGGER "ts_DOCUMENTO_SEQ_ID_DOCUMENTO" BEFORE INSERT
ON "DOCUMENTO" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_DOCUMENTO".nextval INTO :new."ID_DOCUMENTO" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_DOCUMENTO_SEQ_ID_DOCUMENTO" AFTER UPDATE OF "ID_DOCUMENTO"
ON "DOCUMENTO" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_DOCUMENTO" in table "DOCUMENTO" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_ROL for column ID_ROL in table ROL ---------

CREATE OR REPLACE TRIGGER "ts_ROL_SEQ_ID_ROL" BEFORE INSERT
ON "ROL" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_ROL".nextval INTO :new."ID_ROL" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_ROL_SEQ_ID_ROL" AFTER UPDATE OF "ID_ROL"
ON "ROL" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_ROL" in table "ROL" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_HISTORICO for column ID_HISTORICO in table HISTORICO ---------

CREATE OR REPLACE TRIGGER "ts_HISTORICO_SEQ_ID_HISTORICO" BEFORE INSERT
ON "HISTORICO" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_HISTORICO".nextval INTO :new."ID_HISTORICO" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_HISTORICO_SEQ_ID_HISTORICO" AFTER UPDATE OF "ID_HISTORICO"
ON "HISTORICO" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_HISTORICO" in table "HISTORICO" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_TIPO_OPERACION for column ID_TIPO_OPERACION in table TIPO_OPERACION ---------

CREATE OR REPLACE TRIGGER "ts_TIPO_OPERACION_SEQ_ID_TIP_0" BEFORE INSERT
ON "TIPO_OPERACION" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_TIPO_OPERACION".nextval INTO :new."ID_TIPO_OPERACION" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_TIPO_OPERACION_SEQ_ID_TI_0" AFTER UPDATE OF "ID_TIPO_OPERACION"
ON "TIPO_OPERACION" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_TIPO_OPERACION" in table "TIPO_OPERACION" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_FORMATO for column ID_FORMATO in table FORMATO ---------

CREATE OR REPLACE TRIGGER "ts_FORMATO_SEQ_ID_FORMATO" BEFORE INSERT
ON "FORMATO" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_FORMATO".nextval INTO :new."ID_FORMATO" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_FORMATO_SEQ_ID_FORMATO" AFTER UPDATE OF "ID_FORMATO"
ON "FORMATO" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_FORMATO" in table "FORMATO" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_COLA for column ID_COLA in table COLA ---------

CREATE OR REPLACE TRIGGER "ts_COLA_SEQ_ID_COLA" BEFORE INSERT
ON "COLA" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_COLA".nextval INTO :new."ID_COLA" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_COLA_SEQ_ID_COLA" AFTER UPDATE OF "ID_COLA"
ON "COLA" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_COLA" in table "COLA" as it uses sequence.');
END;
/

-- Trigger for sequence SEQ_ID_HISTORICO_COLA for column ID_HISTORICO_COLA in table HISTORICO_COLA ---------

CREATE OR REPLACE TRIGGER "ts_HISTORICO_COLA_SEQ_ID_HIS_0" BEFORE INSERT
ON "HISTORICO_COLA" FOR EACH ROW
BEGIN
	SELECT "SEQ_ID_HISTORICO_COLA".nextval INTO :new."ID_HISTORICO_COLA" FROM DUAL;
END;
/
CREATE OR REPLACE TRIGGER "tsu_HISTORICO_COLA_SEQ_ID_HI_0" AFTER UPDATE OF "ID_HISTORICO_COLA"
ON "HISTORICO_COLA" FOR EACH ROW
BEGIN
	RAISE_APPLICATION_ERROR(-20010,'Cannot update column "ID_HISTORICO_COLA" in table "HISTORICO_COLA" as it uses sequence.');
END;
/



